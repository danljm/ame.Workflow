@{
    ViewBag.Title = "RelationalMap";
}
<link href="@Url.Content("~/Content/demo-all.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/perimeterAnchorsDemo.css")" rel="stylesheet" type="text/css" />
<h2>Relational Map - Test Process</h2>

<div class="field"><input id="chartName" class="input" type="text" placeholder="New Flowchart"></div>
<div class="field"><textarea class="input textarea" placeholder="Enter Process Description" rows="4"></textarea></div>
<div class='medium metro rounded btn primary'><input type='button' value='New' onclick='Clear()'></div>
<div class='medium metro rounded btn primary'><input type='button' value='Save' onclick='Save("Swimlane")'></div>
<div class='medium metro rounded btn primary'><input type='button' value='Discard' onclick='Clear()'></div>

<div id="pallette-menu">
    <ul>
        <h4 style="text-align: center">
            Drawing Palette</h4>
        <li class="pallette-shape">
            <div class="shape pallette roundedRectangle gradient">
                Action<span class="drag_icon">&#10150;</span></div>
        </li>
        <li class="pallette-shape">
            <div class="shape pallette start">
                Start<span class="drag_icon">&#10150;</span></div>
        </li>
        <li class="pallette-shape">
            <div class="shape pallette stop">
                Stop<span class="drag_icon">&#10150;</span></div>
        </li>
        <li class="pallette-shape">
            <div class="shape pallette" data-shape="Diamond">
                Decision<span class="drag_icon">&#10150;</span></div>
        </li>
    </ul>
</div>

<div id="pallette-container">
    <div id="pallette-draw">
        <div class="rel-map supplier">
            <h4>
                Suppliers</h4>
        </div>
        <div class="rel-map organization">
            <h4>
                Organization</h4>
        </div>
        <div class="rel-map customer">
            <h4>
                Customers</h4>
        </div>
        <div id="render">
        </div>
        <div id="window1" class="shape roundedRectangle">Software Provider<span class="drag_icon">&#10150;</span></div>
        <div id="window2" class="shape roundedRectangle">Administration<span class="drag_icon">&#10150;</span></div>
        <div id="window3" class="shape roundedRectangle">Sales<span class="drag_icon">&#10150;</span></div>
        <div id="window4" class="shape roundedRectangle">Service<span class="drag_icon">&#10150;</span></div>
        <div id="window5" class="shape roundedRectangle">Corp. Customer<span class="drag_icon">&#10150;</span></div>
    </div>
</div>

<input type='button' class='k-button' value='Save' onclick='Save()'>
<input type='button' class='k-button' value='Load' onclick='Load()'>
<input type='button' class='k-button' value='Clear' onclick='Clear()'>
<div id='component-input-div' ><input id='component-input' type="text" class=''/></div>


<script type="text/javascript">

    $(document).ready(function () {

        $(".pallette").draggable({
            containment: '#pallette-draw',
            helper: 'clone',
            stop: function (event, ui) {
                $(ui.helper).clone(true, false).removeClass('pallette ui-draggable-dragging jsPlumb_dragged').addClass('clone').appendTo($('#pallette-draw'));

                var clone = $('.clone');
                var pos = $(ui.helper).offset();
                clone.offset({ top: pos.top, left: pos.left });

                jsPlumb.makeTarget(clone, { dropOptions: { hoverClass: "dragHover" }, anchor: "Continuous" });

                jsPlumb.makeSource(clone, {
                    anchor: "Continuous",
                    connector: "Flowchart"
                });

                clone.removeClass('clone');
            }
        });

        $('li').droppable({ hoverClass: "ui-state-active" });

        $(document).on('click', 'div._jsPlumb_overlay.component', function () {
            var thisObj = this,
                jThis = $(this);

            $('#component-input-div').toggle(true).position({
                my: 'left top',
                at: 'left bottom',
                of: thisObj,
                collision: 'fit flip'
            }).find('input').val(jThis.html());

            $('div._jsPlumb_overlay.component.selected').removeClass('selected');
            jThis.addClass('selected');

        });

        $('#component-input').on('keydown', function () {

            if (event.which === 13) {

                $('#component-input-div').toggle(false);
                $('div._jsPlumb_overlay.component.selected').html(this.value);
                $('div._jsPlumb_overlay.component.selected').removeClass('selected');

            }

        });

        /* Connection 1 */
        jsPlumb.connect({ source: $('#window1'), target: $('#window2'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Supplier Invoice", location: 0.7, id: "label1"}]] });
        /* Connection 2 */
        jsPlumb.connect({ source: $('#window2'), target: $('#window1'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Payment", location: 0.7, id: "label2"}]] });
        /* Connection 3 */
        jsPlumb.connect({ source: $('#window2'), target: $('#window1'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Purchase Order", location: 0.7, id: "label3"}]] });
        /* Connection 4 */
        jsPlumb.connect({ source: $('#window2'), target: $('#window3'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "", location: 0.7, id: "label4"}]] });
        /* Connection 5 */
        jsPlumb.connect({ source: $('#window3'), target: $('#window2'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "", location: 0.7, id: "label5"}]] });
        /* Connection 6 */
        jsPlumb.connect({ source: $('#window3'), target: $('#window4'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "", location: 0.7, id: "label6"}]] });
        /* Connection 7 */
        jsPlumb.connect({ source: $('#window4'), target: $('#window5'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Consulting Services Completed", location: 0.7, id: "label7"}]] });
        /* Connection 8 */
        jsPlumb.connect({ source: $('#window2'), target: $('#window5'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Invoice", location: 0.7, id: "label8"}]] });
        /* Connection 9 */
        jsPlumb.connect({ source: $('#window5'), target: $('#window2'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Payment", location: 0.7, id: "label9"}]] });
        /* Connection 10 */
        jsPlumb.connect({ source: $('#window5'), target: $('#window3'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Organizational Change Requested", location: 0.7, id: "label10"}]] });
        /* Connection 11 */
        jsPlumb.connect({ source: $('#window1'), target: $('#window4'), anchor: "Continuous", overlays: [["Label", { cssClass: "component", label: "Software Needed on the Consult", location: 0.7, id: "label11"}]] });
    });  

</script>
<style>
    /* Shape positions */
    #window1
    {
        position: absolute;
        left: 200px;
        top: 297px;
    }
    #window2
    {
        position: absolute;
        left: 740px;
        top: 126px;
    }
    #window3
    {
        position: absolute;
        left: 750px;
        top: 498px;
    }
    #window4
    {
        position: absolute;
        left: 1000px;
        top: 496px;
    }
    #window5
    {
        position: absolute;
        left: 1350px;
        top: 356px;
    }
    
    #component-input-div 
    {
        position: fixed;
        display: block;
        height: 30px;
        width: 150px;
        z-index: 50;
    }
    
    #component-input 
    {
        width: 100%;
        z-index: 50;
    }
    
    .rel-map
    {
        display:inline-block;
        text-align: center;
        height: 95%;
        background: white;
        margin: 1em 1em 1em 1em;
        -webkit-box-shadow: 1px 1px 4px rgba(0,0,0,0.2);
        box-shadow: 1px 1px 4px rgba(0,0,0,0.2);
    }
    
    .supplier
    {
        min-width: 23%;
    }
    
    .organization
    {
        min-width: 45%;
    }
    
    .customer
    {
        min-width: 23%;
    }
    
    .img-list
    {
    	float: left;
        width: 87%;
    }
    
    .list li
    {
        display: table;
        border-collapse: collapse;
        width: 100%;
        height: 250px;
        padding: 5px;
        border-bottom: 2px solid #2C2A67;
    }
    .ui-state-active
    {
        background: #FEFFD6;
    }
    .inner
    {
        display: table-row;
        overflow: hidden;
    }
    .li-text
    {
        /*display: table-cell;*/
        width: 250px;
        vertical-align: middle;
        transform: rotate(-90deg);
        -moz-transform: rotate(-90deg);
        -o-transform: rotate(-90deg);
        -webkit-transform: rotate(-90deg);
        -ms-transform: rotate(-90deg);
        -webkit-transform-origin: 120px 120px;
        -moz-transform-origin: 120px 120px;
        -ms-transform-origin: 120px 120px;
        -o-transform-origin: 120px 120px;
        border-bottom: 2px solid #2C2A67;
    }
    .li-head
    {
        margin: 0;
    }
    .li-sub
    {
        margin: 0;
    }
</style>
